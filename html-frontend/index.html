<!DOCTYPE html>

<html lang="es">
<head>
<meta charset="utf-8"/>
<title>Notas a Uno Mismo</title>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
</head>
<body>
<div class="container mt-4">
<div class="d-flex justify-content-between align-items-center mb-3">
<h2>📝 Notas a Uno Mismo</h2>
<div class="text-end" id="sesionInfo"></div>
</div>
<div class="mb-4" id="loginSection">
<label class="form-label" for="loginEmail">Ingresá tu email para comenzar</label>
<div class="input-group">
<input class="form-control" id="loginEmail" placeholder="tu@email.com" required="" type="email"/>
<button class="btn btn-success" id="iniciarSesion">Iniciar sesión</button>
</div>
</div>
<ul class="nav nav-tabs" id="notaTabs" role="tablist">
<li class="nav-item" role="presentation">
<button class="nav-link active" data-bs-target="#nueva" data-bs-toggle="tab" id="nueva-tab" role="tab" type="button">➕ Nueva Nota</button>
</li>
<li class="nav-item" role="presentation">
<button class="nav-link" data-bs-target="#historial" data-bs-toggle="tab" id="historial-tab" role="tab" type="button">📚 Historial</button>
</li>
<li class="nav-item" role="presentation">
<button class="nav-link" data-bs-target="#buscar" data-bs-toggle="tab" id="buscar-tab" role="tab" type="button">🔍 Buscar Nota</button>
</li>
<li class="nav-item" role="presentation">
<button class="nav-link" data-bs-target="#mapa" data-bs-toggle="tab" id="mapa-tab" role="tab" type="button">🗺️ Mapa</button>
</li>
</ul>
<div class="tab-content pt-4">
<div class="tab-pane fade show active" id="nueva" role="tabpanel">
<form id="notaForm">
<div class="mb-3">
<label class="form-label" for="texto">Tu nota</label>
<textarea class="form-control" id="texto" required="" rows="4"></textarea>
</div>
<div class="mb-3">
<label class="form-label" for="fechaManual">Fecha y hora de la nota (opcional)</label>
<input class="form-control" id="fechaManual" type="datetime-local"/>
</div>

<input id="latitud" type="hidden"/>
<input id="longitud" type="hidden"/>
<div class="mb-3 text-muted" id="geo-status"></div>
<button class="btn btn-primary" type="submit">💾 Guardar Nota</button>

<button class="btn btn-link p-0" id="toggleOpciones" onclick="toggleOpcionesAvanzadas()" type="button">+ Más opciones</button>
<div id="opcionesAvanzadas" style="display:none">
<div class="mb-3">
<label class="form-label" for="emocion">¿Cómo te sentís?</label>
<input class="form-control" id="emocion" type="text"/>
</div>
<div class="mb-3">
<label class="form-label" for="tags">Tags (separados por coma)</label>
<input class="form-control" id="tags" type="text"/>
</div>
<div class="mb-3">
<label class="form-label" for="categoria">Categoría</label>
<input class="form-control" id="categoria" type="text"/>
</div>
<div class="mb-3">
<label class="form-label" for="ubicacion">¿Dónde estás?</label>
<input class="form-control" id="ubicacion" type="text"/>
</div>
</div>
</form>
<div class="mt-3" id="resultado"></div>
<!-- 📊 Contenedor para tokens al guardar -->
<div id="tokensGuardar"></div>
</div>
<div class="tab-pane fade" id="historial" role="tabpanel">
<button class="btn btn-secondary" id="cargarHistorial">📂 Ver Notas</button>
<div class="mt-3" id="resultadoHistorial"></div>
</div>
<div class="tab-pane fade" id="buscar" role="tabpanel">
<div class="mb-3">
<label class="form-label" for="textoBuscar">Texto de búsqueda</label>
<textarea class="form-control" id="textoBuscar" rows="3"></textarea>
</div>
<button class="btn btn-info" id="buscarNotas">🔎 Buscar</button>
<!-- 📊 Contenedor para tokens en búsqueda -->
<div id="tokensBusqueda"></div>
<div class="mt-3" id="resultadoBusqueda"></div>
</div>
<div class="tab-pane fade" id="mapa" role="tabpanel">
<div class="d-flex justify-content-between mt-3">
<button class="btn btn-outline-secondary btn-sm" id="refrescarMapa">🔄 Refrescar Mapa</button>
</div>
<div class="mt-2" id="mapaContainer" style="height: 500px;"></div>
</div>
<!-- Leaflet.js -->
<link href="https://unpkg.com/leaflet/dist/leaflet.css" rel="stylesheet"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="app.js"></script>
<script>
    function toggleOpcionesAvanzadas() {
      const panel = document.getElementById('opcionesAvanzadas');
      const btn = document.getElementById('toggleOpciones');
      if (panel.style.display === 'none') {
        panel.style.display = 'block';
        btn.textContent = '− Ocultar opciones';
      } else {
        panel.style.display = 'none';
        btn.textContent = '+ Más opciones';
      }
    }
    </script></body>
</html>